<!DOCTYPE html>
<html lang="pt-br">
<head>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
	google_ad_client: "ca-pub-3499823579380102",
	enable_page_level_ads: true
  });
  </script>

    <title>Maven Profiles para Projetos Spring-Boot - FullStack Ninja</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="msvalidate.01" content="78C0671DB001DAE17FEE5D7CDDCA9E3C" />

  <link href="http://fullstackninja.com.br/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="FullStack Ninja Full Atom Feed" />
  <link href="http://fullstackninja.com.br/feeds/spring.atom.xml" type="application/atom+xml" rel="alternate" title="FullStack Ninja Categories Atom Feed" />

    <meta property="og:type" content="article">
    <meta property="article:author" content="Pedro Henrique Ribeiro Rodrigues">
    <meta property="article:published_time" content="29 de junho de 2017">
    <meta property="og:locale" content="pt_BR">
    <meta property="og:url" content="http://fullstackninja.com.br/maven-profiles-para-projetos-spring-boot">
    <meta property="og:title" content="Maven Profiles para Projetos Spring-Boot">
    <meta property="og:image" content="http://fullstackninja.com.br/images/spring.png">
    <meta property="og:image:type" content="image/png">
<meta property="og:description" content="Neste post iremos mostrar como usar de maneira fácil os Maven Profiles em conjunto com o Maven Resources para controlar as versões de uma aplicação em cada ambiente. O Problema ...">
    <meta property="description" content="Neste post iremos mostrar como usar de maneira fácil os Maven Profiles em conjunto com o Maven Resources para controlar as versões de uma aplicação em cada ambiente. O Problema ...">

  <!-- Última versão CSS compilada e minificada -->
  <link rel="stylesheet" href="/theme/bootstrap/3.3.7/css/bootstrap.min.css">

  <!-- Tema opcional -->
  <!--<link rel="stylesheet" href="/theme/bootstrap/3.3.7/css/bootstrap-theme.min.css">-->

  <!-- Pygment -->
  <link rel="stylesheet" href="/theme/css/pygment.css">

  <!-- Style -->
  <link rel="stylesheet" href="/theme/css/style.css">

</head>

<body>

<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#blog-menu">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://fullstackninja.com.br">FullStack Ninja</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="blog-menu">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="http://fullstackninja.com.br/categoria/git/">Git</a></li>
        <li class="active"><a href="http://fullstackninja.com.br/categoria/spring/">Spring</a></li>
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>

  <!-- Page Content -->
  <div class="container">

    <div class="row banner-top">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3499823579380102"
     data-ad-slot="4001442477"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>    </div>

    <div class="row">
      <div class="col-lg-8">
<section id="content" class="body">
  <header>
    <h1 class="entry-title">
      <a href="http://fullstackninja.com.br/maven-profiles-para-projetos-spring-boot/" rel="bookmark"
         title="Permalink to Maven Profiles para Projetos Spring-Boot">Maven Profiles para Projetos Spring-Boot</a></h1>
 
  </header>
  <div class="post-info">
    <time class="published" datetime="2017-06-29T00:00:00-03:00">
      29 de junho de 2017
    </time>
    <address class="vcard author">
      Por           <a class="url fn" href="http://fullstackninja.com.br/autor/pedro-henrique-ribeiro-rodrigues/">Pedro Henrique Ribeiro Rodrigues</a>
    </address>
  </div><!-- /.post-info -->
    <hr />
  <div class="entry-content">
    <p>Neste post iremos mostrar como usar de maneira fácil os Maven Profiles em conjunto com o Maven Resources para controlar as versões de uma aplicação em cada ambiente.</p>
<h2>O Problema</h2>
<p>Ao lidar com a migração de sistemas entre <strong>DEV</strong>, <strong>QAS</strong> e <strong>PRD</strong> muitas vezes esbarramos na configuração de váriações de acordo com o ambiente.</p>
<p>Em projetos Spring Boot rodados como Boot projects (<code>java -jar projeto.jar</code>) configuramos inumeros application.properties, um para cada ambiente (ex.: <code>application-dev.properties</code>). Então ao rodar o projeto informa-se o profile escolhido (<code>java -jar -Dspring.profiles.active=dev projeto.jar</code>).</p>
<p><strong>Mais informações em:</strong> <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto-properties-and-configuration.html#howto-change-configuration-depending-on-the-environment">https://docs.spring.io/spring-boot/docs/current/reference/html/howto-properties-and-configuration.html#howto-change-configuration-depending-on-the-environment</a></p>
<p>O problema neste caso é que muitas vezes temos que hospedar o projeto em outros servidores, de modo que não podemos utilizar o seu boot initializer. Sendo assim o que fazer?</p>
<p>Uma saída é utilizar o <strong>Maven Profiles</strong> em conjunto com o <strong>Maven Resources</strong>. Com o <strong>Maven Profiles</strong> conseguimos criar variáveis de acordo com o ambiente e com o <strong>Resources</strong> conseguimos subistituir essas variáveis nos arquivos de configuração do <strong>Spring Boot</strong>.</p>
<h2><a href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-actuator">Spring Boot Actuator</a></h2>
<p>Primeiramente adicionaremos o actuator como uma dependência do nosso projeto:</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<p>O Actuator irá disponibilizar alguns endpoints já 'prontos' para nosso projeto, incluindo o <code>/info</code> que usaremos posteriormente.</p>
<h2><a href="http://maven.apache.org/guides/introduction/introduction-to-profiles.html">Maven Profiles</a></h2>
<p>Maven Profiles é a maneira que maven permite que definamos variáveis e caminhos para o build dependendo do perfil selecionado. No nosso caso configuramos <strong>DEV</strong>, <strong>QAS</strong> e <strong>PRD</strong>:</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
        <span class="nt">&lt;id&gt;</span>dev<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;properties&gt;</span>
            <span class="nt">&lt;app.environment.label&gt;</span>DEV<span class="nt">&lt;/app.environment.label&gt;</span>
            <span class="nt">&lt;app.auth.server.address&gt;</span>server.dev.br<span class="nt">&lt;/app.auth.server.address&gt;</span>
            <span class="nt">&lt;app.auth.server.port&gt;</span>8080<span class="nt">&lt;/app.auth.server.port&gt;</span>
        <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
        <span class="nt">&lt;id&gt;</span>qas<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;properties&gt;</span>
            <span class="nt">&lt;app.environment.label&gt;</span>QAS<span class="nt">&lt;/app.environment.label&gt;</span>
            <span class="nt">&lt;app.auth.server.address&gt;</span>server.qas.br<span class="nt">&lt;/app.auth.server.address&gt;</span>
            <span class="nt">&lt;app.auth.server.port&gt;</span>80<span class="nt">&lt;/app.auth.server.port&gt;</span>
        <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
        <span class="nt">&lt;id&gt;</span>prd<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;properties&gt;</span>
            <span class="nt">&lt;app.environment.label&gt;</span>PRD<span class="nt">&lt;/app.environment.label&gt;</span>
            <span class="nt">&lt;app.auth.server.address&gt;</span>server.prd.br<span class="nt">&lt;/app.auth.server.address&gt;</span>
            <span class="nt">&lt;app.auth.server.port&gt;</span>80<span class="nt">&lt;/app.auth.server.port&gt;</span>
        <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
<span class="nt">&lt;/profiles&gt;</span>
</pre></div>


<p>Para cada profile definimos 3 variáveis: o label do ambiente (<code>app.environment.label</code>), o endereço (<code>app.auth.server.address</code>) e porta (<code>app.auth.server.port</code>) do servidor de autenticação. Sendo assim quando rodarmos o build do maven (<code>mvn clean install -P&lt;profile&gt;</code>) informamos qual o profile a ser utilizado. Temos a opção de colocar a tag <code>activation</code> dentro de um profile o definindo como o padrão caso nenhum seja fornecido:</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;activation&gt;</span>
    <span class="nt">&lt;activeByDefault&gt;</span>true<span class="nt">&lt;/activeByDefault&gt;</span>
<span class="nt">&lt;/activation&gt;</span>
</pre></div>


<p>Com as variáveis definidas precisamos agora utilizalas pelo Spring. É ai que o <strong>Maven Resources</strong> entra em ação.</p>
<h2><a href="https://maven.apache.org/plugins/maven-resources-plugin/">Maven Resources</a></h2>
<p>O <strong>Maven Resources</strong> é um plugin com inumeras utilidades que age principalmente sobre os recursos da aplicação, renomeando, mudando de lugar e até subistituindo o conteúdo de arquivos de acordo com padrões, que é justamente o que precisamos.</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;finalName&gt;</span>projeto<span class="nt">&lt;/finalName&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
        <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>maven-resources-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
                <span class="nt">&lt;delimiters&gt;</span>
                    <span class="nt">&lt;delimiter&gt;</span>@<span class="nt">&lt;/delimiter&gt;</span>
                <span class="nt">&lt;/delimiters&gt;</span>
                <span class="nt">&lt;resources&gt;</span>
                    <span class="nt">&lt;resource&gt;</span>
                        <span class="nt">&lt;directory&gt;</span>src/main/resources<span class="nt">&lt;/directory&gt;</span>
                        <span class="nt">&lt;filtering&gt;</span>true<span class="nt">&lt;/filtering&gt;</span>
                    <span class="nt">&lt;/resource&gt;</span>
                <span class="nt">&lt;/resources&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
        ...
    <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</pre></div>


<p>Essa configuração informa para o plugin que ele deve ler todos os arquivos dentro de <code>src/main/resources</code> e subistituir tudo que for delimitado por <code>@</code>. Ex.: <code>@property.replace@</code></p>
<h2>Spring Boot <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html">application.properties</a></h2>
<p>Dentro do <code>application.properties</code> iremos utilizar as 3 variáveis criadas pelos profiles. Para isso colocaremo-as como filhas da propriedade <code>info</code> que por padrão joga todo o seu conteúdo como JSON através do endpoint <code>/info</code> fornecido pelo actuator:</p>
<div class="highlight"><pre><span></span>server.port=9000

info.environment=@app.environment.label@
info.auth.server=@app.auth.server.address@:@app.auth.server.port@
</pre></div>


<ul>
<li>Definimos a porta da aplicação para 9000 para evitar conflitos na 8080.</li>
<li>Na propriedade <code>environment</code> exibiremos o label do ambiente.</li>
<li>Na propriedade <code>auth.server</code> exibiremos o endereço do servidor e porta.</li>
</ul>
<h2>Testando</h2>
<p>Execute o projeto como spring-boot passando <code>dev</code> como profile (<code>-P</code>)</p>
<div class="highlight"><pre><span></span>mvn spring-boot:run -Pdev
</pre></div>


<p>Acesse <a href="http://localhost:9000/info">http://localhost:9000/info</a></p>
<p><img alt="Resultado do teste" src="/images/20170628/test.jpg" /></p>
<p>Agora realize o mesmo procedimento para <strong>QAS</strong> e <strong>PRD</strong>.</p>
<h2>Código Fonte</h2>
<p><a href="https://github.com/pedrohrr/fullstackninja.com.br/tree/master/projects/maven-profiles-resources" class="btn btn-success">
    GitHub
</a></p>
  </div><!-- /.entry-content -->

<div class="entry-author">
  <h3 class="title">Sobre Pedro Henrique Ribeiro Rodrigues</h3>
  <div class="author-avatar">
    <img alt='' src='https://media.licdn.com/mpr/mpr/shrinknp_400_400/AAEAAQAAAAAAAAtTAAAAJDQzNTY1YThkLWYyNGYtNGI0My1hYzE2LTkzNDI5NmQwOGE2ZA.jpg' class='avatar avatar-68 photo' height='68' width='68' />				</div><!-- /author-avatar -->
  <div class="author-description">
    Desenvolvedor Java desde 2008, fullstack desde 2012, geek e gamer desde sempre
    <div id="author-link">
      <a href="http://fullstackninja.com.br/autor/pedro-henrique-ribeiro-rodrigues/" rel="author">
        Veja todos os posts de Pedro Henrique Ribeiro Rodrigues <span class="meta-nav">&rarr;</span>
      </a>
    </div><!-- /author-link	-->
  </div><!-- /author-description -->
</div><!-- /author-info -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- DJ-Bottom -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3499823579380102"
     data-ad-slot="4001442477"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = http://fullstackninja.com.br/maven-profiles-para-projetos-spring-boot/;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//fullstackninja-com-br.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</section>
      </div>

      <div class="col-md-4">
<a href="https://go.hotmart.com/K6138939L">
<img src="http://www.javaavancado.com/wp-content/uploads/2016/12/Curso-Angular-e-Spring-com-borda-capa-hotmart.png" border="0" width="250" height="250" />
</a>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-3499823579380102"
     data-ad-slot="8431642073"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>      </div>
    </div>

<!-- Footer -->
<footer>
<div class="row">
        <div class="col-lg-12">
                <p>Copyright &copy; FullStack Ninja 2017, todos os direitos reservados.
                        <a href="/politica-de-privacidade/">Política de Privacidade</p>
                </p>
        </div>
</div>
<!-- /.row -->
</footer>
  </div>

<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-102888234-1']);
  _gaq.push(['_trackPageview']);
  _gaq.push(['_setCustomVar', 1, 'userType', 'INTERNAL', 2]);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  <!-- Disqus comments -->
  <script id="dsq-count-scr" src="//fullstackninja-com-br.disqus.com/count.js" async></script>

  <!-- jQuery (obrigatório para plugins JavaScript do Bootstrap) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <!-- Última versão JavaScript compilada e minificada -->
  <script src="/theme/bootstrap/3.3.7/js/bootstrap.min.js"></script>

</body>
</html>